window.__require=function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return o(e[s][1][t]||t)},u,u.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)o(n[s]);return o}({Enemy:[function(t,e,i){"use strict";cc._RF.push(e,"6afdcuNjHREaKfegJuaQ017","Enemy");var n=function(t){return t&&t.__esModule?t:{default:t}}(t("LevelMap"));cc.Class({extends:cc.Component,properties:{life:5,velocity:150,rotationSpeed:300,levelMap:{default:null,type:n.default}},onLoad:function(){var t=this;this.node.on("hit",function(){return t.handleHit()})},start:function(){this.targets=this.levelMap.tileMap.getObjectGroup("path").getObjects(),this.targetIndex=1,this.node.setPosition(this.getCurrrentTargetPosition()),this.move()},handleHit:function(){this.life--,0===this.life&&this.node.destroy()},getCurrentTarget:function(){var t=this;return this.targets.find(function(e){return parseInt(e.name)===t.targetIndex})},getCurrrentTargetPosition:function(){var t=this.getCurrentTarget();if(!t)return!1;var e=this.levelMap.getTileCoordinatesByPosition(cc.v2(t.x,t.y)),i=this.levelMap.roadsLayer.getPositionAt(e.x,e.y),n=i.x+this.levelMap.tileWidth/2,o=i.y+this.levelMap.tileWidth/2;return cc.v2(n,o)},move:function(){var t=this;this.targetIndex++;var e=this.getCurrrentTargetPosition();if(!e)return this.node.emit("finished"),void this.node.destroy();this.moveTo(e).then(function(){return t.move()}),this.rotateTo(e)},getDistance:function(t){var e=Math.abs(t.x-this.node.x),i=Math.abs(t.y-this.node.y);return Math.max(e,i)},moveTo:function(t){var e=this,i=this.getDistance(t)/this.velocity;return new Promise(function(n){var o=cc.moveTo(i,t),r=cc.sequence(o,cc.callFunc(n));e.node.runAction(r)})},rotateTo:function(t){var e=-this.getAngle(t),i=Math.abs(e-this.node.angle);if(i){var n=i/this.rotationSpeed;this.node.runAction(cc.rotateTo(n,e))}},getAngle:function(t){var e=t.x,i=t.y;return 180*Math.atan2(i-this.node.y,e-this.node.x)/Math.PI},onCollisionEnter:function(t,e){"fire"===t.node.name&&this.node.emit("hit")}}),cc._RF.pop()},{LevelMap:"LevelMap"}],Fire:[function(t,e,i){"use strict";cc._RF.push(e,"ecce7G4IWhDyLm97868TQQI","Fire"),cc.Class({extends:cc.Component,properties:{},start:function(){},init:function(){}}),cc._RF.pop()},{}],LevelMap:[function(t,e,i){"use strict";cc._RF.push(e,"32f2dW3kSlC34jXnNF1fNxG","LevelMap"),cc.Class({extends:cc.Component,properties:{},init:function(){this.tileMap=this.getComponent(cc.TiledMap),this.roadsLayer=this.tileMap.getLayer("roads"),this.towersLayer=this.tileMap.getLayer("towers");var t=this.tileMap.getTileSize();this.tileWidth=t.width,this.tileHeight=t.height;var e=this.tileMap.getMapSize();this.mapWidth=e.width,this.mapHeight=e.height},getTileCoordinatesByPosition:function(t){return{x:Math.floor(t.x/this.tileWidth),y:this.mapHeight-Math.floor(t.y/this.tileHeight)-1}}}),cc._RF.pop()},{}],Level:[function(t,e,i){"use strict";cc._RF.push(e,"c25564XQSBOzqlAaYiKjX+C","Level");var n=s(t("LevelMap")),o=s(t("PanelCreate")),r=s(t("Towers"));function s(t){return t&&t.__esModule?t:{default:t}}cc.Class({extends:cc.Component,properties:{panelCreate:{default:null,type:o.default},map:{default:null,type:n.default},towers:{default:null,type:r.default}},onLoad:function(){this.init(),this.setEvents()},init:function(){this.map.init(),this.panelCreate.init(this.map),this.towers.init(this.map)},setEvents:function(){this.map.node.on(cc.Node.EventType.TOUCH_END,this.onMapTouch,this),this.panelCreate.node.on("button-click",this.onTowerCreate,this),this.enableCollision()},enableCollision:function(){cc.director.getCollisionManager().enabled=!0},onTowerCreate:function(t){this.towers.create(t.towerKey,t.towerCoordinates),this.panelCreate.hide()},onMapTouch:function(t){this.panelCreate.hide();var e=t.getLocation(),i={x:2*e.x,y:2*e.y},n=this.map.getTileCoordinatesByPosition(i),o=this.map.towersLayer.getTileGIDAt(n),r=this.towers.getByCoordinates(n);o&&!r&&this.panelCreate.show(n)}}),cc._RF.pop()},{LevelMap:"LevelMap",PanelCreate:"PanelCreate",Towers:"Towers"}],PanelCreate:[function(t,e,i){"use strict";cc._RF.push(e,"097e2u43tVFx5kGV2CzeaNn","PanelCreate"),cc.Class({extends:cc.Component,properties:{button1:{default:null,type:cc.Node},button2:{default:null,type:cc.Node}},init:function(t){this.map=t,this.coordinates={x:0,y:0},this.button1.on(cc.Node.EventType.TOUCH_END,this.onButtonClick,this),this.button2.on(cc.Node.EventType.TOUCH_END,this.onButtonClick,this)},show:function(t){this.coordinates=t;var e=this.map.towersLayer.getPositionAt(this.coordinates),i=e.x,n=e.y;this.node.setPosition(cc.v2(i+this.map.tileWidth/2,n+this.map.tileWidth/2)),this.node.active=!0},hide:function(){this.node.active=!1},onButtonClick:function(t){this.node.emit("button-click",{towerKey:t.target.name,towerCoordinates:this.coordinates})}}),cc._RF.pop()},{}],Towers:[function(t,e,i){"use strict";cc._RF.push(e,"159fdnc+JRO4q3Wkv8tYZvn","Towers"),cc.Class({extends:cc.Component,properties:{towersPrefabs:{default:[],type:[cc.Prefab]}},init:function(t){this.map=t,this.items=[]},create:function(t,e){var i=cc.instantiate(this.towersPrefabs.find(function(e){return e.name===t}));this.node.addChild(i);var n=i.getComponent("Tower");n.init(e),this.items.push(n);var o=this.map.towersLayer.getPositionAt(e),r=o.x,s=o.y;i.setPosition(cc.v2(r+this.map.tileWidth/2,s+this.map.tileHeight/2))},getByCoordinates:function(t){return this.items.find(function(e){var i=e.coordinates,n=i.x,o=i.y;return n===t.x&&o===t.y})}}),cc._RF.pop()},{}],Tower:[function(t,e,i){"use strict";cc._RF.push(e,"151f1vccSJI4Jm+ePvSKmiY","Tower"),cc.Class({extends:cc.Component,properties:{fire:{default:null,type:cc.Prefab},rotationSpeed:300,reloadTime:.3,fireSpeed:.2},init:function(t){var e=this;this.coordinates=t,this.targets=[],this.schedule(function(){e.tryFire()},this.reloadTime)},onCollisionEnter:function(t,e){"enemy1"===t.node.name&&this.targets.push(t.node)},onCollisionExit:function(t,e){this.removeTarget(t.node)},removeTarget:function(t){this.targets=this.targets.filter(function(e){return e!==t})},getTarget:function(){return!!this.targets.length&&this.targets.find(function(t){return t.active})},tryFire:function(){var t=this,e=this.getTarget();if(e&&e.active){var i=cc.v2(e.x,e.y);this.rotateTo(i).then(function(){return t.createFire(i)})}},createFire:function(t){var e=cc.instantiate(this.fire);e.position=cc.v2(this.node.x,this.node.y),e.angle=this.node.angle,this.node.parent.addChild(e),e.getComponent("Fire").init(),this.moveFire(e,t)},moveFire:function(t,e){var i=cc.moveTo(this.fireSpeed,e.x,e.y),n=cc.sequence(i,cc.callFunc(function(){return t.destroy()}));t.runAction(n)},rotateTo:function(t){var e=this,i=-this.getAngle(t),n=Math.abs(i-this.node.angle);return new Promise(function(t){var o=n/e.rotationSpeed;if(!n)return t();var r=cc.sequence(cc.rotateTo(o,i),cc.callFunc(t));e.node.runAction(r)})},getAngle:function(t){var e=t.x,i=t.y;return 180*Math.atan2(i-this.node.y,e-this.node.x)/Math.PI-90}}),cc._RF.pop()},{}]},{},["Enemy","Fire","Level","LevelMap","PanelCreate","Tower","Towers"]);